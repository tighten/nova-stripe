window.onload = showWelcomeDialog;

document.addEventListener('inertia:navigate', showWelcomeDialog);

function showWelcomeDialog() {
    if (!window.location.pathname.includes('/resources/stripe-')) return;

    if (localStorage.getItem('nova-stripe-intro-shown')) return;

    if (document.getElementById('welcome-dialog')) return;

    const dialog = document.createElement('dialog');
    dialog.id = 'welcome-dialog';
    dialog.style = 'position: relative; padding: 2rem; border-radius: 1rem; max-width: 36rem;';
    dialog.innerHTML = `
        <div class="mx-auto z-20 text-center">
            <button id="closeDialog" style="font-weight: bold; position: absolute; top: 0.5rem; right: 0.5rem; background-color: black; color: white; border-radius: 50%; height: 1.5rem; width: 1.5rem; font-size: 1.25rem; display: flex; justify-content: center; align-items: center; outline: none" title="Close">&times;</button>
            <h2 class="text-lg font-bold mb-4">To sync your Stripe resources, choose "Sync With Stripe" from the dropdown menu in the top-right corner.</h2>
            <div id="intro-image"></div>
        </div>
    `;

    document.body.appendChild(dialog);

    const imgContainer = document.getElementById('intro-image');
    imgContainer.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 375 172.5" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><clipPath id="b"><use href="#a"/></clipPath><clipPath id="c"><path d="M17.74 42.9H352.9V172H17.74Zm0 0"/></clipPath><clipPath id="d"><path d="M23.73 42.9h323.09a6 6 0 0 1 5.98 5.99v126.2c0 3.3-2.68 5.97-5.98 5.97H23.72a6 6 0 0 1-5.98-5.98V48.88c0-3.3 2.68-5.97 5.99-5.97m0 0"/></clipPath><clipPath id="e"><path d="M17.75 42.9h335.02V172H17.75Zm0 0"/></clipPath><clipPath id="f"><path d="M23.73 42.9h323.08a6 6 0 0 1 5.98 5.99v126.18c0 3.3-2.68 5.98-5.99 5.98H23.74a6 6 0 0 1-5.98-5.98V48.9a6 6 0 0 1 5.98-5.98m0 0"/></clipPath><clipPath id="g"><path d="M17.74 17.1H130.1v16.76H17.74Zm0 0"/></clipPath><clipPath id="h"><path d="M26.12 17.1h95.55a8.38 8.38 0 0 1 0 16.76H26.12a8.38 8.38 0 0 1 0-16.75m0 0"/></clipPath><clipPath id="i"><path d="M17.76 17.1h112.16v16.45H17.76Zm0 0"/></clipPath><clipPath id="j"><path d="M26.13 17.1h95.52a8.37 8.37 0 1 1 0 16.75H26.13a8.37 8.37 0 0 1 0-16.74m0 0"/></clipPath><clipPath id="k"><path d="M22.83 21.1h8.98V30h-8.98Zm0 0"/></clipPath><clipPath id="l"><path d="M325.08 17.1h25.43v16.45h-25.43Zm0 0"/></clipPath><clipPath id="m"><path d="M327.33 17.1h20.98a2.24 2.24 0 0 1 2.24 2.25V31.6a2.24 2.24 0 0 1-2.24 2.25h-20.98a2.24 2.24 0 0 1-2.25-2.25V19.36a2.24 2.24 0 0 1 2.25-2.25m0 0"/></clipPath><clipPath id="n"><path d="M270.5 36.66h80.13v26.2H270.5Zm0 0"/></clipPath><clipPath id="o"><path d="M275.73 36.66h69.6c1.38 0 2.71.56 3.7 1.54a5.2 5.2 0 0 1 1.53 3.7v15.73a5.2 5.2 0 0 1-1.54 3.7 5.2 5.2 0 0 1-3.7 1.54h-69.59a5.24 5.24 0 0 1-5.23-5.24V41.9a5.24 5.24 0 0 1 5.23-5.24m0 0"/></clipPath><clipPath id="p"><path d="M270.5 36.67h80.01v26.17H270.5Zm0 0"/></clipPath><clipPath id="q"><path d="M275.73 36.67h69.58c1.4 0 2.72.55 3.7 1.53a5.2 5.2 0 0 1 1.54 3.7v15.73a5.23 5.23 0 0 1-5.24 5.23h-69.58a5.23 5.23 0 0 1-5.23-5.23V41.9c0-1.39.55-2.72 1.53-3.7a5.2 5.2 0 0 1 3.7-1.53m0 0"/></clipPath><clipPath id="r"><path d="M18.68 71.09H351.9v21.86H18.68Zm0 0"/></clipPath><clipPath id="s"><path d="M199 5h55v55h-55Zm0 0"/></clipPath><clipPath id="t"><path d="m203.36 2.72 53.43 44.53-15.8 18.95-53.43-44.52Zm0 0"/></clipPath><clipPath id="u"><path d="m187.5 21.75 53.43 44.52 15.8-18.95L203.3 2.79Zm0 0"/></clipPath><path id="a" d="M.54 0h373.92v172H.54Zm0 0"/></defs><g fill="#fff" clip-path="url(#b)"><use href="#a"/><use href="#a"/></g><g clip-path="url(#c)"><g clip-path="url(#d)"><path fill="#fff" d="M17.74 42.9H352.9v138.16H17.74Zm0 0"/></g></g><g clip-path="url(#e)"><g clip-path="url(#f)"><path fill="none" stroke="#a4aebd" stroke-width="1.5" d="M23.73 42.9h323.08a6 6 0 0 1 5.98 5.99v126.18c0 3.3-2.68 5.98-5.99 5.98H23.74a6 6 0 0 1-5.98-5.98V48.9a6 6 0 0 1 5.98-5.98Zm0 0"/></g></g><g clip-path="url(#g)"><g clip-path="url(#h)"><path fill="#fff" d="M17.74 17.1h112.28v16.76H17.74Zm0 0"/></g></g><g clip-path="url(#i)"><g clip-path="url(#j)"><path fill="none" stroke="#a4aebd" stroke-width="1.5" d="M26.13 17.1h95.52a8.37 8.37 0 1 1 0 16.75H26.13a8.37 8.37 0 0 1 0-16.74Zm0 0"/></g></g><g clip-path="url(#k)"><path fill="#a4aebd" fill-rule="evenodd" d="m28.46 27.5 2.14 2.15c.21.2.56.2.77 0a.54.54 0 0 0 0-.77l-2.14-2.14a3.54 3.54 0 0 0-2.86-5.64 3.54 3.54 0 0 0-3.54 3.54 3.54 3.54 0 0 0 5.63 2.86m-2.09-5.3a2.45 2.45 0 1 1 0 4.9 2.45 2.45 0 0 1 0-4.9m0 0"/></g><g clip-path="url(#l)"><g clip-path="url(#m)"><path fill="none" stroke="#67caf2" stroke-width="1.5" d="M327.33 17.1h20.98a2.24 2.24 0 0 1 2.24 2.25V31.6a2.24 2.24 0 0 1-2.24 2.25h-20.98a2.24 2.24 0 0 1-2.25-2.25V19.36a2.24 2.24 0 0 1 2.25-2.25Zm0 0"/></g></g><g clip-path="url(#n)"><g clip-path="url(#o)"><path fill="#fff" d="M270.5 36.66h80.02v26.2H270.5Zm0 0"/></g></g><g clip-path="url(#p)"><g clip-path="url(#q)"><path fill="none" stroke="#a4aebd" stroke-width="1.5" d="M275.73 36.67h69.58c1.4 0 2.72.55 3.7 1.53a5.2 5.2 0 0 1 1.54 3.7v15.73a5.23 5.23 0 0 1-5.24 5.23h-69.58a5.23 5.23 0 0 1-5.23-5.23V41.9c0-1.39.55-2.72 1.53-3.7a5.2 5.2 0 0 1 3.7-1.53Zm0 0"/></g></g><path d="M284.8 52.45q-.48 0-.85-.13a2 2 0 0 1-.6-.34 1.3 1.3 0 0 1-.38-.45l.31-.4h.1q.45.8 1.41.79.57 0 .85-.24a.8.8 0 0 0 .28-.65 1 1 0 0 0-.1-.43 1 1 0 0 0-.3-.28 2 2 0 0 0-.55-.22l-.6-.14q-.65-.15-.97-.5-.3-.34-.3-.87 0-.36.2-.66.17-.3.56-.45.38-.17.87-.17.57 0 .96.17.38.15.62.47l-.3.39h-.07a1.4 1.4 0 0 0-.52-.4 2 2 0 0 0-.69-.12q-.51 0-.78.2a.7.7 0 0 0-.26.57q0 .33.18.53.2.2.67.31l.6.14q.72.18 1.05.54.32.34.32.89 0 .42-.18.75-.2.33-.58.51a2 2 0 0 1-.96.19m2.84 1.51q-.18 0-.36-.03l-.28-.1.11-.43.06-.01.2.06q.13.03.26.03a1 1 0 0 0 .37-.06 1 1 0 0 0 .27-.2 1 1 0 0 0 .18-.4l.14-.36-1.51-3.86h.6l1.18 3.08h.08l1.14-3.07h.56l-1.67 4.36q-.14.35-.33.57a1 1 0 0 1-.42.32q-.24.1-.58.1m3.87-1.59v-3.76h.53v.59l.06.01q.2-.33.49-.5.3-.16.7-.17.68 0 .98.35.32.34.32 1.06v2.42h-.57v-2.4q0-.35-.09-.55a.6.6 0 0 0-.27-.3 1 1 0 0 0-.46-.1q-.53 0-.83.35-.31.34-.31 1.06v1.94Zm5.82.08q-.5 0-.89-.22a2 2 0 0 1-.62-.67q-.24-.45-.23-1.07 0-.6.23-1.06a1.6 1.6 0 0 1 .62-.65q.39-.24.9-.24.58 0 .95.22.35.23.51.6l-.39.28h-.06a1 1 0 0 0-.4-.46q-.24-.15-.62-.14-.35 0-.6.16a1 1 0 0 0-.41.48q-.14.34-.14.82 0 .45.14.8.16.32.4.5.27.15.62.15.38 0 .64-.17.25-.2.42-.57h.06l.38.2a1.5 1.5 0 0 1-.54.77q-.37.27-.97.27m5.6-.08h-.76l-1.14-4.98h.58l.93 4.12h.1l1.1-4.12h.55l1.13 4.12h.08l.93-4.12h.57l-1.13 4.98h-.78l-1.03-3.78h-.08Zm5.27-4.48q-.18 0-.3-.11a.4.4 0 0 1-.1-.28.4.4 0 0 1 .1-.29.4.4 0 0 1 .3-.1q.17 0 .28.1.1.12.11.29t-.1.28a.4.4 0 0 1-.29.1m-.28 4.48V48.6h.55v3.76Zm3.75-.6.18.4a1 1 0 0 1-.35.2 1 1 0 0 1-.47.08q-1.07 0-1.07-1.1v-2.3h-.66v-.44h.66v-.8l.54-.1v.9h1.22v.45h-1.22v2.23q0 .66.57.66a1 1 0 0 0 .53-.17Zm.97.6V47.1h.55v2.04h.08q.4-.6 1.16-.6.68 0 .98.34t.31 1.06v2.42h-.56v-2.4q0-.35-.1-.55a.6.6 0 0 0-.26-.3 1 1 0 0 0-.47-.1q-.51 0-.83.33-.3.33-.3 1.08v1.94Zm7.56.08q-.48 0-.85-.13a2 2 0 0 1-.6-.34 1.3 1.3 0 0 1-.38-.45l.31-.4h.1q.45.8 1.42.79.55 0 .84-.24a.8.8 0 0 0 .28-.65 1 1 0 0 0-.1-.43 1 1 0 0 0-.3-.28 2 2 0 0 0-.55-.22l-.6-.14q-.65-.15-.97-.5-.3-.34-.3-.87 0-.36.2-.66.18-.3.56-.45.38-.17.87-.17.57 0 .96.17.38.15.62.47l-.3.39h-.07a1.4 1.4 0 0 0-.52-.4 2 2 0 0 0-.69-.12q-.51 0-.78.2a.7.7 0 0 0-.26.57q0 .33.18.53.2.2.68.31l.59.14q.72.18 1.05.54.33.34.33.89 0 .42-.2.75-.18.33-.57.51a2 2 0 0 1-.95.19m4.64-.67.17.39a1 1 0 0 1-.34.2 1 1 0 0 1-.47.08q-1.08 0-1.08-1.1v-2.3h-.66v-.44h.66v-.8l.55-.1v.9h1.22v.45h-1.22v2.23q0 .66.56.66a1 1 0 0 0 .53-.17Zm.97.59V48.6h.53v.59l.06.01q.27-.64 1-.64a1 1 0 0 1 .58.14l-.16.47-.06.02a1 1 0 0 0-.47-.11q-.46 0-.7.34-.24.33-.23 1.1v1.84Zm3.18-4.48q-.18 0-.3-.11a.4.4 0 0 1-.1-.28.4.4 0 0 1 .1-.29.4.4 0 0 1 .3-.1q.18 0 .28.1a.4.4 0 0 1 .11.29q0 .16-.1.28a.4.4 0 0 1-.29.1m-.28 4.48v-3.76h.55v3.76Zm1.87 1.53v-5.3h.54v.57l.08.01q.43-.64 1.23-.64.48 0 .82.22.35.2.54.64t.2 1.1-.2 1.07a1.4 1.4 0 0 1-.58.66 1.6 1.6 0 0 1-.82.22q-.38 0-.67-.13a1.3 1.3 0 0 1-.52-.45l-.08.02v2.01Zm1.68-1.95q1.16 0 1.16-1.46 0-1.45-1.16-1.45-.33 0-.6.16a1 1 0 0 0-.4.47q-.15.33-.14.82 0 .5.14.82.16.33.4.48.27.16.6.16m5.72-1.33h-2.58q0 .69.33 1.02.3.3.84.3.39 0 .64-.13a1 1 0 0 0 .4-.46h.06l.35.2q-.15.43-.51.66a1.7 1.7 0 0 1-.94.24q-.55 0-.95-.22a1.5 1.5 0 0 1-.61-.66q-.2-.44-.2-1.08 0-.63.21-1.07.24-.45.63-.66t.87-.22q.74 0 1.14.4.4.42.41 1.21l-.01.42Zm-.45-.47q-.02-.6-.27-.86-.25-.28-.73-.28-.49 0-.77.28-.28.27-.34.86Zm0 0"/><g clip-path="url(#r)"><path fill="#f4f7fa" d="M18.68 71.09h333.18v21.86H18.68Zm0 0"/></g><g clip-path="url(#s)"><g clip-path="url(#t)"><g clip-path="url(#u)"><path d="M202.3 5.8c-1.28-.13-1.65.66-1.95 1.47a14.4 14.4 0 0 0-.96 6.89 44 44 0 0 0 8.26 20.63 33.7 33.7 0 0 0 18.08 13c3.54 1.05 7.14 1.9 10.84 2.88-.34.21-.74.51-1.18.73-3 1.53-3.37 2.16-3.12 5.54.05.76.25 1.5.4 2.46.71-.24 1.23-.4 1.73-.58 5.42-1.98 10.8-4.06 16.28-5.9a2.9 2.9 0 0 0 2.14-2.27c.56-2.19.18-4.4-.4-6.5-.2-.74-1.18-1.38-1.94-1.85a86 86 0 0 1-15.4-11.83c-1.45-1.42-2.68-3.06-4.14-4.73-.6.34-.75 1.14-.84 1.85-.44 3.35-.28 6.57 2.15 9.25l3.45 3.8c.52.55 1.1 1.06 1.77 1.71-5.07.68-19.06-6.3-24.35-12-6.44-6.93-9.9-15.22-10.83-24.56m0 0"/></g></g></g><path d="M334.26 25.65a.8.8 0 0 1-.58-.2.7.7 0 0 1-.2-.53q0-.33.2-.53a.8.8 0 0 1 .58-.22q.35 0 .56.2.22.19.22.53a.8.8 0 0 1-.22.55.8.8 0 0 1-.56.2m3.4 0a.8.8 0 0 1-.57-.2.7.7 0 0 1-.2-.53q0-.33.2-.53a.8.8 0 0 1 .58-.22q.35 0 .56.2.21.19.22.53a.8.8 0 0 1-.22.55.8.8 0 0 1-.56.2m3.42 0a.8.8 0 0 1-.58-.2.7.7 0 0 1-.2-.53q0-.33.2-.53a.8.8 0 0 1 .58-.22q.36 0 .56.2.21.19.22.53a.8.8 0 0 1-.22.55.8.8 0 0 1-.56.2m0 0"/></svg>';
    imgContainer.style.width = '100%';
    imgContainer.style.maxWidth = '630px';

    dialog.showModal();

    document.getElementById('closeDialog').addEventListener('click', () => {
        dialog.close();
    });

    dialog.onclose = function () {
        localStorage.setItem('nova-stripe-intro-shown', 1);
    };
}
